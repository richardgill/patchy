{"id":"patchy-1","title":"Implement patchy apply command","description":"The apply command exists but is a stub that only prints 'applying..'. It needs to actually:\n- Copy new files from patches/ to repo_dir\n- Apply .diff files to existing files in repo_dir\n- Handle errors gracefully (missing files, failed patches)\n- Respect --dry-run flag (already shows message, but should list what would be done)\n\nLocation: src/commands/apply/impl.ts:21","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T12:28:09.564008556Z","updated_at":"2025-12-08T12:42:25.546227185Z","closed_at":"2025-12-08T12:42:25.546227185Z"}
{"id":"patchy-10","title":"Add confirmation prompt to repo reset command","description":"## Context\n\n`patchy repo reset` runs `git reset --hard` which is a destructive operation that discards all local changes. Users should be prompted to confirm before this happens.\n\n## Proposed Behavior\n\n```\n$ patchy repo reset --repo-base-dir repos --repo-dir my-repo\nThis will discard all uncommitted changes in repos/my-repo. Continue? [y/N]\n```\n\n## Flags (following Vercel CLI pattern)\n\n- `--yes` / `-y` - Skip confirmation prompt and proceed\n- Could also respect `--dry-run` to show what would be reset without prompting\n\n## Implementation\n\n1. Add `yes` flag to `src/commands/repo/reset/command.ts`\n2. Add `YesCommandFlags` or extend `ResetCommandFlags` in `src/config/types.ts`\n3. Update `src/commands/repo/reset/impl.ts:68` to prompt before `git.reset([\"--hard\"])`\n4. Use `enquirer` (already a dependency) for the prompt\n\n## Example from Vercel CLI\n\n```\n$ vercel rm my-project\n\u003e The project \"my-project\" will be removed permanently.\n? Are you sure you want to continue? (y/N)\n```\n\n## File\n\n- src/commands/repo/reset/impl.ts:68","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-08T15:31:27.495652292Z","updated_at":"2025-12-08T15:31:27.495652292Z"}
{"id":"patchy-11","title":"Convert project bundling from tsdown to bun","description":"Replace tsdown with bun for bundling the CLI. Goal: create standalone binaries for distribution while maintaining npm publishability.\n\n## Plan\n\n### Phase 1: Replace tsdown with Bun bundler\n- Update build script to use `bun build`\n- Remove tsdown and tsx dependencies\n- Keep JS bundle output for npm publishing\n\n### Phase 2: Add standalone binary compilation\n- Add build:binary script using `bun build --compile`\n- Cross-compile for: linux-x64, darwin-x64, darwin-arm64, windows-x64\n\n### Phase 3: Replace enquirer with @clack/prompts\n- Enquirer has known Bun compatibility issues (readline/arrow keys)\n- @clack/prompts is modern and Bun-compatible\n\n### Phase 4: Update CI\n- Add Bun setup to GitHub Actions\n- Build binaries in CI for releases\n\n### Tools to remove\n- tsdown\n- tsx (Bun runs TS natively)\n\n### Keep for now\n- pnpm (package manager)\n- vitest (test runner)\n- tsgo (type checking - Bun doesn't type-check)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T15:49:57.096547195Z","updated_at":"2025-12-08T17:40:06.159990296Z","closed_at":"2025-12-08T17:40:06.159990296Z"}
{"id":"patchy-12","title":"Add dry-run support to repo reset and repo checkout commands","description":"The apply, generate, and repo clone commands all support --dry-run flag, but repo reset and repo checkout do not. These are destructive operations that would benefit from dry-run support to preview what would happen.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T17:12:41.783873766Z","updated_at":"2025-12-08T17:15:17.303242242Z","closed_at":"2025-12-08T17:15:17.303242242Z"}
{"id":"patchy-13","title":"Replace tsdown with bun build for JS bundle","description":"Update package.json build script from tsdown to bun build.\n\nChanges needed:\n1. Update \"build\" script: `bun build ./src/cli.ts --outfile ./dist/cli.js --target node --minify`\n2. Update \"dev\" script: `bun run src/cli.ts`\n3. Delete tsdown.config.ts\n4. Remove tsdown from devDependencies\n5. Remove tsx from devDependencies\n6. Verify bundled output works: `node ./dist/cli.js --help`\n7. Verify path aliases (~/`) resolve correctly\n\nNote: Bun reads tsconfig.json paths automatically, so aliases should work.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T17:34:29.71898607Z","updated_at":"2025-12-08T17:36:10.215421784Z","closed_at":"2025-12-08T17:36:10.215421784Z"}
{"id":"patchy-14","title":"Add standalone binary compilation","description":"Add build:binary script for standalone executable compilation.\n\nScripts to add:\n- build:binary - compile for current platform\n- build:binary:all - cross-compile for all platforms\n\nTarget platforms:\n- bun-linux-x64\n- bun-darwin-x64  \n- bun-darwin-arm64\n- bun-windows-x64\n\nExample:\n```\n\"build:binary\": \"bun build ./src/cli.ts --compile --minify --outfile ./dist/patchy\",\n\"build:binary:all\": \"scripts/build-all-platforms.sh\"\n```\n\nCreate scripts/build-all-platforms.sh for cross-compilation.\nOutput binaries to dist/bin/ directory.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T17:34:29.866843873Z","updated_at":"2025-12-08T17:39:15.440175344Z","closed_at":"2025-12-08T17:39:15.440175344Z","dependencies":[{"issue_id":"patchy-14","depends_on_id":"patchy-13","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"patchy-15","title":"Replace enquirer with @clack/prompts","description":"Replace enquirer with @clack/prompts for Bun compatibility.\n\nEnquirer has known issues with Bun's readline implementation (arrow keys don't work).\n@clack/prompts is modern, has better DX, and works with Bun.\n\nFiles to update:\n- src/commands/init/impl.ts (uses enquirer for interactive prompts)\n\nChanges:\n1. pnpm remove enquirer\n2. pnpm add @clack/prompts\n3. Update init command to use @clack/prompts API\n4. Test interactive prompts work in both:\n   - bun run src/cli.ts init\n   - ./dist/patchy init (standalone binary)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T17:34:30.008237682Z","updated_at":"2025-12-08T17:37:25.149647541Z","closed_at":"2025-12-08T17:37:25.149647541Z"}
{"id":"patchy-16","title":"Update CI for Bun builds","description":"Update GitHub Actions to use Bun for building.\n\nChanges to .github/actions/setup/action.yml:\n- Add oven-sh/setup-bun@v2 step\n\nChanges to .github/workflows/pre-checks.yml:\n- Build job should use bun build\n\nFuture (separate task): \n- Release workflow to build and upload binaries for all platforms","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T17:34:30.152525304Z","updated_at":"2025-12-08T17:40:06.1599764Z","closed_at":"2025-12-08T17:40:06.1599764Z","dependencies":[{"issue_id":"patchy-16","depends_on_id":"patchy-13","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"patchy-17","title":"Verify all removed dependencies are cleaned up","description":"After all changes are complete, verify:\n\n1. No imports of removed packages remain:\n   - grep for \"enquirer\" \n   - grep for \"tsdown\"\n   - grep for \"tsx\" (in context of the removed package)\n\n2. No stale configuration files:\n   - tsdown.config.ts should be deleted\n\n3. package.json is clean:\n   - No references to removed packages in dependencies\n   - No references to removed packages in devDependencies\n   - Scripts don't reference removed tools\n\n4. Run full test suite to confirm nothing is broken","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T17:36:31.73463127Z","updated_at":"2025-12-08T17:40:06.159988212Z","closed_at":"2025-12-08T17:40:06.159988212Z"}
{"id":"patchy-2","title":"Implement patchy generate command","description":"The generate command exists but is a stub that only prints 'Generating patches...'. It needs to actually:\n- Detect dirty changes in repo_dir (new files, modified files)\n- Generate .diff files for modified files\n- Copy new files to patches/ directory\n- Mirror the repo_dir directory structure in patches/\n- Respect --dry-run flag (already shows message, but should list what would be generated)\n\nLocation: src/commands/generate/impl.ts:21","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T12:28:09.70065921Z","updated_at":"2025-12-08T13:02:51.566735461Z","closed_at":"2025-12-08T13:02:51.566735461Z"}
{"id":"patchy-3","title":"Implement patchy repo reset command","description":"The 'patchy repo reset' command is documented in README but does not exist. It should:\n- Hard reset the Git working tree of repo_dir\n- Discard all local changes (git reset --hard)\n- Accept --repo-dir flag\n- Show appropriate confirmation/output\n\nNeeds: new command structure in src/commands/repo/","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T12:28:09.838884021Z","updated_at":"2025-12-08T15:46:03.937064617Z","closed_at":"2025-12-08T15:46:03.937064617Z"}
{"id":"patchy-4","title":"Implement patchy repo checkout command","description":"The 'patchy repo checkout --ref \u003cgit-ref\u003e' command is documented in README but does not exist. It should:\n- Check out a specific Git ref (branch, tag, or SHA) in repo_dir\n- Accept --ref flag (required)\n- Accept --repo-dir flag\n- Handle errors (invalid ref, dirty working tree)\n\nNeeds: new command structure in src/commands/repo/","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T12:28:09.996673342Z","updated_at":"2025-12-08T15:25:55.964447375Z","closed_at":"2025-12-08T15:25:55.964447375Z"}
{"id":"patchy-5","title":"Implement patchy repo clone command","description":"The 'patchy repo clone --url \u003cgit-url\u003e' command is documented in README but does not exist. It should:\n- Clone a repository into a subdirectory of repo_base_dir\n- Derive target directory name from repo URL\n- Accept --repo-base-dir flag\n- Accept --ref flag to checkout specific ref after clone\n- Accept --repo-url flag\n- Handle errors (invalid URL, directory exists)\n\nNeeds: new command structure in src/commands/repo/","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T12:28:10.142754323Z","updated_at":"2025-12-08T14:49:57.768886903Z","closed_at":"2025-12-08T14:49:57.768886903Z"}
{"id":"patchy-6","title":"Implement environment variable support","description":"README documents environment variables but they are NOT implemented. The config resolver only handles CLI flags and JSON config.\n\nRequired env vars to support:\n- PATCHY_REPO_DIR\n- PATCHY_REPO_BASE_DIR\n- PATCHY_PATCHES_DIR\n- PATCHY_CONFIG\n- PATCHY_VERBOSE\n- PATCHY_DRY_RUN\n- PATCHY_REPO_URL\n- PATCHY_REF\n\nImplementation needs:\n1. Update config resolver (src/config/resolver.ts) to read process.env\n2. Maintain precedence: CLI flags \u003e env vars \u003e config file \u003e defaults\n3. Update CLI --help output to mention corresponding env var for each flag (modern CLI best practice)\n4. Example help format: '--repo-dir \u003cpath\u003e  Path to repo [env: PATCHY_REPO_DIR]'\n\nLocation: src/config/resolver.ts","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T12:28:10.289417564Z","updated_at":"2025-12-08T12:36:21.690294706Z","closed_at":"2025-12-08T12:36:21.690294706Z"}
{"id":"patchy-7","title":"Allow configuring fuzzFactor for patch application","description":"Currently fuzzFactor is hardcoded to 2 in apply-diff.ts. Allow users to configure this via:\n- CLI flag: --fuzz-factor\n- Config: fuzz_factor in patchy.json\n- Env var: PATCHY_FUZZ_FACTOR\n\nHigher values allow patches to apply even when context lines have shifted, but may cause incorrect applications. Default should remain 2.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-08T13:13:06.449587993Z","updated_at":"2025-12-08T13:13:14.340668831Z"}
{"id":"patchy-8","title":"Find generic solution for ProcessExitError re-throw pattern","description":"## Context\n\nMultiple command implementations (clone, reset) have this boilerplate pattern:\n\n```typescript\ntry {\n  // command logic\n} catch (error) {\n  if (error instanceof Error \u0026\u0026 error.name === \"ProcessExitError\") {\n    throw error;\n  }\n  // handle other errors\n}\n```\n\nThis is needed because in tests, `process.exit` throws a `ProcessExitError` that needs to propagate, but we also want to catch and handle other errors gracefully.\n\n## Problem\n\n- Duplicated boilerplate across commands\n- Easy to forget when adding new commands\n- Not obvious why this pattern is needed\n\n## Possible Solutions\n\n1. **Wrapper function** - Create a `withErrorHandling(fn)` HOF that handles this pattern\n2. **Custom error class** - Create a `CommandError` that commands throw, and handle ProcessExitError at a higher level\n3. **Test infrastructure change** - Mock process.exit differently so it doesn't throw\n4. **Stricli integration** - Check if stricli has built-in error handling we can leverage\n\n## Files with this pattern\n\n- src/commands/repo/clone/impl.ts\n- src/commands/repo/reset/impl.ts","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-08T15:17:07.046756614Z","updated_at":"2025-12-08T15:17:07.046756614Z"}
{"id":"patchy-9","title":"Modernize apply and generate commands to use createMergedConfig","description":"## Context\n\nThe `clone` and `reset` commands use modern patterns while `apply` and `generate` use older patterns.\n\n## Current State\n\n| Command | Config | ProcessExitError |\n|---------|--------|------------------|\n| `apply` | `resolveConfig` ❌ | ❌ |\n| `generate` | `resolveConfig` ❌ | ❌ |\n| `clone` | `createMergedConfig` ✅ | ✅ |\n| `reset` | `createMergedConfig` ✅ | ✅ |\n\n## Changes Needed\n\n1. **apply/impl.ts** - Migrate from `resolveConfig` to `createMergedConfig`\n2. **generate/impl.ts** - Migrate from `resolveConfig` to `createMergedConfig`\n\n## Benefits\n\n- Consistent error handling across all commands\n- Synchronous config resolution (no async needed)\n- Result-based error handling instead of throwing\n- Prepares for ProcessExitError solution (patchy-8)\n\n## Files\n\n- src/commands/apply/impl.ts\n- src/commands/generate/impl.ts\n\n## Related\n\n- patchy-8: ProcessExitError generic solution","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T15:29:50.762538739Z","updated_at":"2025-12-08T17:11:37.052778105Z","closed_at":"2025-12-08T17:11:37.052778105Z"}
