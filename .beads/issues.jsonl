{"id":"patchy-1","title":"Implement patchy apply command","description":"The apply command exists but is a stub that only prints 'applying..'. It needs to actually:\n- Copy new files from patches/ to repo_dir\n- Apply .diff files to existing files in repo_dir\n- Handle errors gracefully (missing files, failed patches)\n- Respect --dry-run flag (already shows message, but should list what would be done)\n\nLocation: src/commands/apply/impl.ts:21","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T12:28:09.564008556Z","updated_at":"2025-12-08T12:42:25.546227185Z","closed_at":"2025-12-08T12:42:25.546227185Z"}
{"id":"patchy-10","title":"Add confirmation prompt to repo reset command","description":"## Context\n\n`patchy repo reset` runs `git reset --hard` which is a destructive operation that discards all local changes. Users should be prompted to confirm before this happens.\n\n## Proposed Behavior\n\n```\n$ patchy repo reset --repo-base-dir repos --repo-dir my-repo\nThis will discard all uncommitted changes in repos/my-repo. Continue? [y/N]\n```\n\n## Flags (following Vercel CLI pattern)\n\n- `--yes` / `-y` - Skip confirmation prompt and proceed\n- Could also respect `--dry-run` to show what would be reset without prompting\n\n## Implementation\n\n1. Add `yes` flag to `src/commands/repo/reset/command.ts`\n2. Add `YesCommandFlags` or extend `ResetCommandFlags` in `src/config/types.ts`\n3. Update `src/commands/repo/reset/impl.ts:68` to prompt before `git.reset([\"--hard\"])`\n4. Use `enquirer` (already a dependency) for the prompt\n\n## Example from Vercel CLI\n\n```\n$ vercel rm my-project\n\u003e The project \"my-project\" will be removed permanently.\n? Are you sure you want to continue? (y/N)\n```\n\n## File\n\n- src/commands/repo/reset/impl.ts:68","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T15:31:27.495652292Z","updated_at":"2025-12-08T17:14:31.504791793Z","closed_at":"2025-12-08T17:14:31.504791793Z"}
{"id":"patchy-11","title":"Convert project bundling from tsdown to bun","description":"Replace tsdown with bun for bundling the CLI. Currently using tsdown (see package.json build script). Bun's bundler offers faster builds and native TypeScript support. Changes needed: update build script, verify output works as CLI, update any related CI/build configs.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T15:49:57.096547195Z","updated_at":"2025-12-08T18:37:27.213882481Z","closed_at":"2025-12-08T18:37:27.213882481Z"}
{"id":"patchy-12","title":"Add dry-run support to repo reset and repo checkout commands","description":"The apply, generate, and repo clone commands all support --dry-run flag, but repo reset and repo checkout do not. These are destructive operations that would benefit from dry-run support to preview what would happen.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T17:12:41.783873766Z","updated_at":"2025-12-08T17:15:17.303242242Z","closed_at":"2025-12-08T17:15:17.303242242Z"}
{"id":"patchy-13","title":"Ensure Claude Code web has bd installed via mise","description":"Make sure bd (beads) is configured in mise.toml and that Claude Code web runs 'mise install' to have bd available. This enables automatic context recovery and issue tracking in Claude Code web sessions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T17:49:55.458250788Z","updated_at":"2025-12-08T18:36:02.982035941Z","closed_at":"2025-12-08T18:36:02.982035941Z"}
{"id":"patchy-14","title":"Explore options for improving e2e test readability","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T18:59:22.299803898Z","updated_at":"2025-12-08T19:24:59.263843205Z","closed_at":"2025-12-08T19:24:59.263843205Z"}
{"id":"patchy-15","title":"Explore CLI distribution patterns (Bun binaries + npm)","description":"# Goal\n\nUnderstand CLI distribution best practices and document how this project handles distribution in CONTRIBUTOR.md.\n\n# Research Tasks\n\n## 1. Research Bun binary distribution\n- Use `gh search code` to find examples of projects distributing CLIs as Bun binaries\n- Understand compilation, cross-platform builds, release workflows\n\n## 2. Research npm distribution\n- How do CLI tools publish to npm?\n- Best practices for bin field, shebang, etc.\n\n## 3. Document this project's approach\n- How does patchy currently handle distribution?\n- Add clear documentation to CONTRIBUTOR.md\n\n# Deliverable\n\nUpdated CONTRIBUTOR.md with clear documentation on how distribution works in this project.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T19:00:05.465209723Z","updated_at":"2025-12-08T19:27:37.425379529Z","closed_at":"2025-12-08T19:27:37.425379529Z","dependencies":[{"issue_id":"patchy-15","depends_on_id":"patchy-16","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"patchy-15","depends_on_id":"patchy-17","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"patchy-16","title":"Research Bun binary CLI distribution patterns","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T19:00:16.245961517Z","updated_at":"2025-12-08T19:26:57.742098386Z","closed_at":"2025-12-08T19:26:57.742098386Z"}
{"id":"patchy-17","title":"Research npm CLI distribution patterns","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T19:00:19.507033879Z","updated_at":"2025-12-08T19:26:57.742105759Z","closed_at":"2025-12-08T19:26:57.742105759Z"}
{"id":"patchy-18","title":"Document patchy distribution in CONTRIBUTOR.md","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T19:00:24.95240206Z","updated_at":"2025-12-08T19:27:37.425407151Z","closed_at":"2025-12-08T19:27:37.425407151Z","dependencies":[{"issue_id":"patchy-18","depends_on_id":"patchy-16","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"patchy-18","depends_on_id":"patchy-17","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"patchy-19","title":"Allow pushes for .beads/ directory on main branch","description":"Configure branch protection or CI to allow direct pushes to main when only .beads/ files are modified. This enables bd issue tracking updates without requiring PRs.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T19:06:56.368385591Z","updated_at":"2025-12-08T19:14:21.035010011Z","closed_at":"2025-12-08T19:14:21.035010011Z"}
{"id":"patchy-2","title":"Implement patchy generate command","description":"The generate command exists but is a stub that only prints 'Generating patches...'. It needs to actually:\n- Detect dirty changes in repo_dir (new files, modified files)\n- Generate .diff files for modified files\n- Copy new files to patches/ directory\n- Mirror the repo_dir directory structure in patches/\n- Respect --dry-run flag (already shows message, but should list what would be generated)\n\nLocation: src/commands/generate/impl.ts:21","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T12:28:09.70065921Z","updated_at":"2025-12-08T13:02:51.566735461Z","closed_at":"2025-12-08T13:02:51.566735461Z"}
{"id":"patchy-20","title":"Port opencode's Bun binary distribution pattern to patchy","description":"","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T20:47:24.180372425Z","updated_at":"2025-12-08T20:52:36.673636601Z","closed_at":"2025-12-08T20:52:36.673636601Z","dependencies":[{"issue_id":"patchy-20","depends_on_id":"patchy-21","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"patchy-20","depends_on_id":"patchy-22","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"patchy-20","depends_on_id":"patchy-23","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"patchy-20","depends_on_id":"patchy-24","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"patchy-20","depends_on_id":"patchy-25","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"patchy-20","depends_on_id":"patchy-26","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"patchy-21","title":"Create build.ts script for multi-platform Bun compilation","description":"Port opencode's build.ts pattern to compile patchy CLI to standalone binaries for all platforms (linux-x64, linux-arm64, darwin-x64, darwin-arm64, windows-x64). Reference: ~/code/reference-repos/opencode/packages/opencode/script/build.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T20:47:36.064361938Z","updated_at":"2025-12-08T20:52:29.264267273Z","closed_at":"2025-12-08T20:52:29.264267273Z"}
{"id":"patchy-22","title":"Create publish.ts script for npm binary distribution","description":"Port opencode's publish.ts pattern to publish platform-specific packages to npm with optionalDependencies. Reference: ~/code/reference-repos/opencode/packages/opencode/script/publish.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T20:47:36.221371521Z","updated_at":"2025-12-08T20:52:29.264295336Z","closed_at":"2025-12-08T20:52:29.264295336Z","dependencies":[{"issue_id":"patchy-22","depends_on_id":"patchy-21","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"patchy-22","depends_on_id":"patchy-23","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"patchy-22","depends_on_id":"patchy-24","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"patchy-22","depends_on_id":"patchy-26","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"patchy-23","title":"Create postinstall.mjs for binary symlinking","description":"Port opencode's postinstall.mjs to symlink the correct platform binary after npm install. Reference: ~/code/reference-repos/opencode/packages/opencode/script/postinstall.mjs","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T20:47:36.371263965Z","updated_at":"2025-12-08T20:52:29.264279506Z","closed_at":"2025-12-08T20:52:29.264279506Z"}
{"id":"patchy-24","title":"Create bin wrapper script for platform binary resolution","description":"Port opencode's bin/opencode wrapper that finds and executes the correct platform-specific binary. Reference: ~/code/reference-repos/opencode/packages/opencode/bin/opencode","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T20:47:36.5302968Z","updated_at":"2025-12-08T20:52:29.264284245Z","closed_at":"2025-12-08T20:52:29.264284245Z"}
{"id":"patchy-25","title":"Add GitHub Actions workflow for binary releases","description":"Create workflow to build binaries on tag push and upload to GitHub Releases. Consider patterns from lazyshell (native builds) or opencode (cross-compilation).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T20:47:36.679966787Z","updated_at":"2025-12-08T20:52:29.264288032Z","closed_at":"2025-12-08T20:52:29.264288032Z"}
{"id":"patchy-26","title":"Update package.json for binary distribution","description":"Update package.json with new scripts (build:binary, publish:binary) and prepare structure for optionalDependencies pattern.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T20:47:36.834457328Z","updated_at":"2025-12-08T20:52:29.264291829Z","closed_at":"2025-12-08T20:52:29.264291829Z"}
{"id":"patchy-27","title":"Replace pnpm with bun","description":"Migrate from pnpm to bun for package management. Need to ensure everything still works throughout the migration.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T21:20:14.021335239Z","updated_at":"2025-12-09T17:17:10.193863411Z","closed_at":"2025-12-09T17:17:10.193863411Z","dependencies":[{"issue_id":"patchy-27","depends_on_id":"patchy-28","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"patchy-27","depends_on_id":"patchy-29","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"patchy-28","title":"Investigate replacing vitest with bun test","description":"Evaluate whether to replace vitest with bun's built-in test runner as part of the pnpm-\u003ebun migration. Consider feature parity, compatibility, and migration effort.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T21:20:18.663336822Z","updated_at":"2025-12-09T17:13:48.151114011Z","closed_at":"2025-12-09T17:13:48.151114011Z"}
{"id":"patchy-29","title":"Define verification steps for pnpm-\u003ebun migration","description":"Document how to verify everything still works during and after migration: tests pass, CLI builds, dev workflow works, etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T21:20:23.071394269Z","updated_at":"2025-12-09T17:14:23.480681683Z","closed_at":"2025-12-09T17:14:23.480681683Z"}
{"id":"patchy-3","title":"Implement patchy repo reset command","description":"The 'patchy repo reset' command is documented in README but does not exist. It should:\n- Hard reset the Git working tree of repo_dir\n- Discard all local changes (git reset --hard)\n- Accept --repo-dir flag\n- Show appropriate confirmation/output\n\nNeeds: new command structure in src/commands/repo/","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T12:28:09.838884021Z","updated_at":"2025-12-08T15:46:03.937064617Z","closed_at":"2025-12-08T15:46:03.937064617Z"}
{"id":"patchy-4","title":"Implement patchy repo checkout command","description":"The 'patchy repo checkout --ref \u003cgit-ref\u003e' command is documented in README but does not exist. It should:\n- Check out a specific Git ref (branch, tag, or SHA) in repo_dir\n- Accept --ref flag (required)\n- Accept --repo-dir flag\n- Handle errors (invalid ref, dirty working tree)\n\nNeeds: new command structure in src/commands/repo/","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T12:28:09.996673342Z","updated_at":"2025-12-08T15:25:55.964447375Z","closed_at":"2025-12-08T15:25:55.964447375Z"}
{"id":"patchy-5","title":"Implement patchy repo clone command","description":"The 'patchy repo clone --url \u003cgit-url\u003e' command is documented in README but does not exist. It should:\n- Clone a repository into a subdirectory of repo_base_dir\n- Derive target directory name from repo URL\n- Accept --repo-base-dir flag\n- Accept --ref flag to checkout specific ref after clone\n- Accept --repo-url flag\n- Handle errors (invalid URL, directory exists)\n\nNeeds: new command structure in src/commands/repo/","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T12:28:10.142754323Z","updated_at":"2025-12-08T14:49:57.768886903Z","closed_at":"2025-12-08T14:49:57.768886903Z"}
{"id":"patchy-6","title":"Implement environment variable support","description":"README documents environment variables but they are NOT implemented. The config resolver only handles CLI flags and JSON config.\n\nRequired env vars to support:\n- PATCHY_REPO_DIR\n- PATCHY_REPO_BASE_DIR\n- PATCHY_PATCHES_DIR\n- PATCHY_CONFIG\n- PATCHY_VERBOSE\n- PATCHY_DRY_RUN\n- PATCHY_REPO_URL\n- PATCHY_REF\n\nImplementation needs:\n1. Update config resolver (src/config/resolver.ts) to read process.env\n2. Maintain precedence: CLI flags \u003e env vars \u003e config file \u003e defaults\n3. Update CLI --help output to mention corresponding env var for each flag (modern CLI best practice)\n4. Example help format: '--repo-dir \u003cpath\u003e  Path to repo [env: PATCHY_REPO_DIR]'\n\nLocation: src/config/resolver.ts","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T12:28:10.289417564Z","updated_at":"2025-12-08T12:36:21.690294706Z","closed_at":"2025-12-08T12:36:21.690294706Z"}
{"id":"patchy-7","title":"Allow configuring fuzzFactor for patch application","description":"Currently fuzzFactor is hardcoded to 2 in apply-diff.ts. Allow users to configure this via:\n- CLI flag: --fuzz-factor\n- Config: fuzz_factor in patchy.json\n- Env var: PATCHY_FUZZ_FACTOR\n\nHigher values allow patches to apply even when context lines have shifted, but may cause incorrect applications. Default should remain 2.\n","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T13:13:06.449587993Z","updated_at":"2025-12-08T18:29:51.596957822Z","closed_at":"2025-12-08T18:29:51.596957822Z"}
{"id":"patchy-8","title":"Find generic solution for ProcessExitError re-throw pattern","description":"## Context\n\nMultiple command implementations (clone, reset) have this boilerplate pattern:\n\n```typescript\ntry {\n  // command logic\n} catch (error) {\n  if (error instanceof Error \u0026\u0026 error.name === \"ProcessExitError\") {\n    throw error;\n  }\n  // handle other errors\n}\n```\n\nThis is needed because in tests, `process.exit` throws a `ProcessExitError` that needs to propagate, but we also want to catch and handle other errors gracefully.\n\n## Problem\n\n- Duplicated boilerplate across commands\n- Easy to forget when adding new commands\n- Not obvious why this pattern is needed\n\n## Possible Solutions\n\n1. **Wrapper function** - Create a `withErrorHandling(fn)` HOF that handles this pattern\n2. **Custom error class** - Create a `CommandError` that commands throw, and handle ProcessExitError at a higher level\n3. **Test infrastructure change** - Mock process.exit differently so it doesn't throw\n4. **Stricli integration** - Check if stricli has built-in error handling we can leverage\n\n## Files with this pattern\n\n- src/commands/repo/clone/impl.ts\n- src/commands/repo/reset/impl.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T15:17:07.046756614Z","updated_at":"2025-12-08T17:26:09.934071492Z","closed_at":"2025-12-08T17:26:09.934071492Z"}
{"id":"patchy-9","title":"Modernize apply and generate commands to use createMergedConfig","description":"## Context\n\nThe `clone` and `reset` commands use modern patterns while `apply` and `generate` use older patterns.\n\n## Current State\n\n| Command | Config | ProcessExitError |\n|---------|--------|------------------|\n| `apply` | `resolveConfig` ❌ | ❌ |\n| `generate` | `resolveConfig` ❌ | ❌ |\n| `clone` | `createMergedConfig` ✅ | ✅ |\n| `reset` | `createMergedConfig` ✅ | ✅ |\n\n## Changes Needed\n\n1. **apply/impl.ts** - Migrate from `resolveConfig` to `createMergedConfig`\n2. **generate/impl.ts** - Migrate from `resolveConfig` to `createMergedConfig`\n\n## Benefits\n\n- Consistent error handling across all commands\n- Synchronous config resolution (no async needed)\n- Result-based error handling instead of throwing\n- Prepares for ProcessExitError solution (patchy-8)\n\n## Files\n\n- src/commands/apply/impl.ts\n- src/commands/generate/impl.ts\n\n## Related\n\n- patchy-8: ProcessExitError generic solution","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T15:29:50.762538739Z","updated_at":"2025-12-08T17:11:37.052778105Z","closed_at":"2025-12-08T17:11:37.052778105Z"}
